"use strict";(self.webpackChunkEleccionesFront=self.webpackChunkEleccionesFront||[]).push([[343],{343:(j,h,i)=>{i.r(h),i.d(h,{EscrutinioModule:()=>K});var p=i(6575),d=i(3744),t=i(1699),T=i(9986),f=i(9743),Z=i(9877),u=i(4860),E=i(7033);let v=(()=>{class s{constructor(e,o){this.http=e,this.Urls=o,this.url=o.apiUrl}getHttpHeaders(){return new u.WM({"Content-Type":"application/json",Accept:"application/json"})}getEscuelasDeLaEleccion(e){const o=this.url+"escuelas/getEscuelaByEleccion/",a=e,n=(new u.LE).set("idEleccion",a),l={headers:this.getHttpHeaders(),params:n};return this.http.get(o,l)}getListasElectoralesPorEleccion(e){const o=this.url+"listas/obtenerPorEleccion/",a=(new u.LE).set("eleccion_id",e),n={headers:this.getHttpHeaders(),params:a};return this.http.get(o,n)}getResultadoMesaPorCargo(e,o){const a=this.url+"escrutinio/resultadoMesa";let n=new u.LE;n=n.set("id_mesa",e.toString()),n=n.set("id_cargo",o.toString());const l={headers:this.getHttpHeaders(),params:n};return this.http.get(a,l)}guardarResultadoMesa(e){const o=this.url+"escrutinio/gurdarResultado";let a=new u.LE;a=a.set("id_mesa",e.mesa_id),a=a.set("id_cargo",e.cargo_id);const n={headers:this.getHttpHeaders(),params:a};return this.http.post(o,e,n)}}return s.\u0275fac=function(e){return new(e||s)(t.LFG(u.eN),t.LFG(E.Y))},s.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();var y=i(2484),S=i(6515),C=i(895),m=i(1465),_=i(3228),g=i(5787),M=i(257);function A(s,r){if(1&s){const e=t.EpF();t.TgZ(0,"mat-list-item",11),t.NdJ("click",function(){const n=t.CHM(e).$implicit,l=t.oxw(2);return t.KtG(l.redirectToCarga(n.id))}),t.TgZ(1,"a"),t._uU(2),t.qZA()()}if(2&s){const e=r.$implicit;t.xp6(2),t.Oqu(e.numeroMesa)}}function F(s,r){if(1&s&&(t.TgZ(0,"mat-expansion-panel",9)(1,"mat-expansion-panel-header")(2,"mat-panel-title"),t._uU(3),t.qZA()(),t.TgZ(4,"mat-nav-list"),t.YNc(5,A,3,1,"mat-list-item",10),t.qZA()()),2&s){const e=r.$implicit;t.xp6(3),t.Oqu(e.nombre),t.xp6(2),t.Q6J("ngForOf",e.MesaElectorals)}}let O=(()=>{class s{constructor(e,o,a,n){this.breakpointObserver=e,this.escrutinioService=o,this.route=a,this.router=n,this.isHandsetSubject=new Z.x,this.data=[],this.isHandset$=this.isHandsetSubject.asObservable(),this.id_eleccion=this.route.snapshot.params.id_eleccion,this.breakpointObserver.observe(f.u3.Handset).subscribe(l=>{this.isHandsetSubject.next(l.matches)})}ngOnInit(){this.loadMenu()}loadMenu(){this.escrutinioService.getEscuelasDeLaEleccion(this.id_eleccion).subscribe({next:e=>{this.data=e,this.isHandsetSubject.next(!1)}})}redirectToCarga(e){this.router.navigate(["carga",e],{relativeTo:this.route})}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(f.Yg),t.Y36(v),t.Y36(d.gz),t.Y36(d.F0))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-sidebar-escrutinio"]],decls:19,vars:10,consts:[[1,"sidenav-container","sidebar-container"],["fixedInViewport","",1,"sidenav",3,"mode","opened"],["drawer",""],["multi","true"],["class","mat-elevation-z0",4,"ngFor","ngForOf"],["color","primary"],["type","button","aria-label","Toggle sidenav","mat-icon-button","",3,"click"],["aria-label","Side nav toggle icon"],[1,"example-spacer"],[1,"mat-elevation-z0"],["matLine","",3,"click",4,"ngFor","ngForOf"],["matLine","",3,"click"]],template:function(e,o){if(1&e){const a=t.EpF();t.TgZ(0,"mat-sidenav-container",0)(1,"mat-sidenav",1,2),t.ALo(3,"async"),t.ALo(4,"async"),t.ALo(5,"async"),t.TgZ(6,"mat-toolbar"),t._uU(7,"Menu"),t.qZA(),t.TgZ(8,"mat-accordion",3),t.YNc(9,F,6,2,"mat-expansion-panel",4),t.qZA()(),t.TgZ(10,"mat-sidenav-content")(11,"mat-toolbar",5)(12,"button",6),t.NdJ("click",function(){t.CHM(a);const l=t.MAs(2);return t.KtG(l.toggle())}),t.TgZ(13,"mat-icon",7),t._uU(14,"menu"),t.qZA()(),t._UZ(15,"span",8),t.TgZ(16,"span"),t._uU(17,"Escrutinio Elecciones 2023"),t.qZA()(),t._UZ(18,"router-outlet"),t.qZA()()}2&e&&(t.xp6(1),t.Q6J("mode",t.lcZ(4,6,o.isHandset$)?"over":"side")("opened",!1===t.lcZ(5,8,o.isHandset$)),t.uIk("role",t.lcZ(3,4,o.isHandset$)?"dialog":"navigation"),t.xp6(8),t.Q6J("ngForOf",o.data))},dependencies:[p.sg,d.lC,y.Ye,S.Hw,C.RK,m.JX,m.TM,m.Rh,_.Hk,_.Tg,g.pp,g.ib,g.yz,g.yK,M.X2,p.Ov]}),s})(),D=(()=>{class s{constructor(e){this.setupService=e,this.e=null,this.setupService.eleccionOb$.subscribe(o=>this.e=o)}ngOnInit(){}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(T.U))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-layout"]],decls:2,vars:0,consts:[[1,"dashboard"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"app-sidebar-escrutinio"),t.qZA())},dependencies:[O]}),s})();var H=i(2828),J=i(7889),N=i.n(J),b=i(4018),L=i(5573),c=i(8849),R=i(9754),x=i(1268),V=i(9674),P=i(6355);function I(s,r){if(1&s&&(t.TgZ(0,"mat-option",5),t._uU(1),t.qZA()),2&s){const e=r.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e.nombre)}}function Y(s,r){if(1&s){const e=t.EpF();t.TgZ(0,"div",2)(1,"h2"),t._uU(2),t.qZA(),t.TgZ(3,"mat-form-field")(4,"mat-label"),t._uU(5,"Cargos"),t.qZA(),t.TgZ(6,"mat-select",3),t.NdJ("selectionChange",function(a){t.CHM(e);const n=t.oxw();return t.KtG(n.onSelectChange(a))}),t.YNc(7,I,2,2,"mat-option",4),t.qZA()()()}if(2&s){const e=t.oxw();t.xp6(2),t.AsE("Escuela: ",e.mesa.Escuela.nombre," Mesa Numero: ",e.mesa.numeroMesa,""),t.xp6(5),t.Q6J("ngForOf",e.cargos)}}function U(s,r){if(1&s){const e=t.EpF();t.TgZ(0,"div",7)(1,"mat-form-field",7)(2,"mat-label",8),t._uU(3),t.qZA(),t.TgZ(4,"input",10),t.NdJ("change",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.actualizarValores())})("ngModelChange",function(a){const l=t.CHM(e).$implicit;return t.KtG(l.cantidadVotos=a)}),t.qZA()()()}if(2&s){const e=r.$implicit;t.xp6(3),t.HOy("",e.ListaElectoral.numero_lista," - ",e.ListaElectoral.nombre," - ",e.ListaElectoral.Candidato.nombre," ",e.ListaElectoral.Candidato.apellido,""),t.xp6(1),t.Q6J("ngModel",e.cantidadVotos)}}function $(s,r){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"div",6)(2,"mat-form-field",7)(3,"mat-label",8),t._uU(4,"Votos Afirmativos"),t.qZA(),t.TgZ(5,"input",9),t.NdJ("ngModelChange",function(a){t.CHM(e);const n=t.oxw();return t.KtG(n.resultadoMesa.votosAfirmativos=a)}),t.qZA()(),t.TgZ(6,"mat-form-field",7)(7,"mat-label",8),t._uU(8,"Votos Blancos"),t.qZA(),t.TgZ(9,"input",10),t.NdJ("change",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.actualizarValores())})("ngModelChange",function(a){t.CHM(e);const n=t.oxw();return t.KtG(n.resultadoMesa.votosBlancos=a)}),t.qZA()(),t.TgZ(10,"mat-form-field",7)(11,"mat-label",8),t._uU(12,"Votos Nulos"),t.qZA(),t.TgZ(13,"input",10),t.NdJ("change",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.actualizarValores())})("ngModelChange",function(a){t.CHM(e);const n=t.oxw();return t.KtG(n.resultadoMesa.votosNulos=a)}),t.qZA()(),t.TgZ(14,"mat-form-field",7)(15,"mat-label",8),t._uU(16,"Votos Recurridos"),t.qZA(),t.TgZ(17,"input",10),t.NdJ("change",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.actualizarValores())})("ngModelChange",function(a){t.CHM(e);const n=t.oxw();return t.KtG(n.resultadoMesa.votosRecurridos=a)}),t.qZA()(),t.TgZ(18,"mat-form-field",7)(19,"mat-label",8),t._uU(20,"Votos Impugnados"),t.qZA(),t.TgZ(21,"input",10),t.NdJ("change",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.actualizarValores())})("ngModelChange",function(a){t.CHM(e);const n=t.oxw();return t.KtG(n.resultadoMesa.votosImpuganados=a)}),t.qZA()(),t.TgZ(22,"mat-form-field",7)(23,"mat-label",8),t._uU(24,"Total"),t.qZA(),t.TgZ(25,"input",9),t.NdJ("ngModelChange",function(a){t.CHM(e);const n=t.oxw();return t.KtG(n.totalVotos=a)}),t.qZA()()(),t.YNc(26,U,5,5,"div",11),t.TgZ(27,"button",12),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.guardar())}),t._uU(28,"Guardar"),t.qZA()()}if(2&s){const e=t.oxw();t.xp6(5),t.Q6J("ngModel",e.resultadoMesa.votosAfirmativos),t.xp6(4),t.Q6J("ngModel",e.resultadoMesa.votosBlancos),t.xp6(4),t.Q6J("ngModel",e.resultadoMesa.votosNulos),t.xp6(4),t.Q6J("ngModel",e.resultadoMesa.votosRecurridos),t.xp6(4),t.Q6J("ngModel",e.resultadoMesa.votosImpuganados),t.xp6(4),t.Q6J("ngModel",e.totalVotos),t.xp6(1),t.Q6J("ngForOf",e.resultadoMesa.DetalleResultado)}}const z=[{path:"",component:D,children:[{path:"carga/:id_mesa",component:(()=>{class s{constructor(e,o,a,n,l,Q){this.escrutinioService=e,this.route=o,this.zone=a,this.crudService=n,this.formBuilder=l,this.functionCallingService=Q,this.cargos=[],this.listas=[],this.listasFiltradas=[],this.idCargoSelected=0,this.totalVotos=0,this.funciones=[],this.formulario=this.formBuilder.group({})}ngOnDestroy(){this.navigateSusbcriptions.unsubscribe()}ngOnInit(){this.route.parent?.params.subscribe(e=>{this.eleccion_id=e.id_eleccion,this.navigateSusbcriptions&&this.navigateSusbcriptions.unsubscribe(),this.navigateSusbcriptions=this.route.params.subscribe(o=>{this.mesa_id=o.id_mesa,this.resultadoMesa=void 0,this.loadMesa(),this.loadListasElectorales()})}),this.subscription=this.functionCallingService.functionReturned$.subscribe(e=>{this.zone.run(()=>{if(e.length>0&&e.includes("name")){const o=JSON.parse(e);try{o.arguments=JSON.parse(o.arguments)}catch(a){console.error(a)}"set_votes"===o.name.trim()?this.cargarResultadoPorVoz(o.arguments):console.log("La funci\xf3n no est\xe1 definida o no se proporcion\xf3 un nombre v\xe1lido."),console.log(e)}})})}loadCargos(){this.cargos=this.listas.map(e=>e.Cargo).filter((e,o,a)=>a.findIndex(n=>n.id===e.id)===o)}loadListasElectorales(){this.escrutinioService.getListasElectoralesPorEleccion(this.eleccion_id).subscribe({next:e=>{this.listas=e,this.loadCargos()}})}loadMesa(){const e=new H.q;e.id=this.mesa_id,this.crudService.getById(e).subscribe({next:o=>{this.mesa=o},error:o=>{N().fire({icon:"error",title:"Oops...",text:o})}})}filtrarListasPorCargo(e){this.listasFiltradas=this.listas.filter(o=>o.cargo_id===e)}onSelectChange(e){this.idCargoSelected=e.value.id,this.filtrarListasPorCargo(this.idCargoSelected),this.escrutinioService.getResultadoMesaPorCargo(this.mesa_id,this.idCargoSelected).subscribe(o=>{let a=new b.i;o?a=Object.assign(new b.i,o):(a.mesa_id=this.mesa_id,a.cargo_id=this.idCargoSelected,a.total=0,a.votosAfirmativos=0,a.votosBlancos=0,a.votosImpuganados=0,a.votosNulos=0,a.votosRecurridos=0,a.DetalleResultado=[]),this.agregarDetallesFaltantes(a),this.resultadoMesa=a,console.log(a),this.actualizarValores()}),this.armarFunctionsCallings(),this.functionCallingService.addPromptText(this.armarPromtCastellano()),console.log("Valor seleccionado:",this.idCargoSelected)}armarFunctionsCallings(){this.funciones=[{name:"set_votes",description:"",parameters:{type:"object",properties:{votes:{type:"array",items:{type:"object",properties:{name:{type:"string",description:"Name of candidate, e.g. Juan Manuel"},id:{type:"string",description:"Id of candidate, e.g. 1"},qty_vote:{type:"integer",description:"Number of votes, e.g. 100"}}}},blanco:{type:"integer",description:"Numero de votos en blanco, e.g. 20"},nulos:{type:"integer",description:"Numero de votos nulos, e.g. 5"},recurridos:{type:"integer",description:"Numero de votos recurridos, e.g 3"},impugnados:{type:"integer",description:"Numero de votos impugnados, e.g. 1"}}}}],this.functionCallingService.addFunctions(this.funciones)}armarPromt(){let e="You have the following candidates name / candidate ID number /political parties name/political parties number:";for(let o=0;o<this.listasFiltradas.length;o++){const a=this.listasFiltradas[o];e+=`\n${o}. ${a.Candidato.nombre} ${a.Candidato.apellido} / ${a.Candidato.id} / ${a.nombre} /  ${a.numero_lista}`}return e+="\nThe goal is set the votes for candidates in the list above.",e}armarPromtCastellano(){let e="You have the following candidates name with candidate ID number and political parties name with political parties number:";for(let o=0;o<this.listasFiltradas.length;o++){const a=this.listasFiltradas[o];let n=`{\n        "candidate_name": "${a.Candidato.nombre.replace(/"/g,"")} ${a.Candidato.apellido.replace(/"/g,"")}",\n        "candidate_id": "${a.Candidato.id}",\n        "political_party": "${a.nombre}",\n        "list_number": "${a.numero_lista}"\n      }`;o<this.listasFiltradas.length-1&&(n+=","),e=e+"\n"+n}return e+="\nThe goal is set the votes for candidates in the list above.\n    If the user try to set vote to a candidate that is not in the list, inform the situation to user.\n    Please you not try to set vote to a candidate that is not in the list",e}agregarDetallesFaltantes(e){this.listasFiltradas.forEach(o=>{e.DetalleResultado.find(n=>n.lista_id===o.id)||e.DetalleResultado.push({mesa_id:this.mesa_id,cargo_id:this.idCargoSelected,lista_id:o.id,ListaElectoral:o,cantidadVotos:0})})}actualizarValores(){const e=this.resultadoMesa?.DetalleResultado.map(o=>o.cantidadVotos).reduce((o,a)=>o+a);this.resultadoMesa&&(this.resultadoMesa.votosAfirmativos=e||0,this.totalVotos=this.resultadoMesa.votosAfirmativos+this.resultadoMesa.votosBlancos+this.resultadoMesa.votosImpuganados+this.resultadoMesa.votosNulos+this.resultadoMesa.votosRecurridos)}guardar(){console.log(this.resultadoMesa),this.resultadoMesa&&this.escrutinioService.guardarResultadoMesa(this.resultadoMesa).subscribe({next:e=>{console.log(e)},error:e=>{console.log(e)}})}validarResultado(){return!1}cargarResultadoPorVoz(e){e.votes&&e.votes.forEach(o=>{const a=this.resultadoMesa?.DetalleResultado.find(n=>n.ListaElectoral.Candidato.id==o.id);a&&(a.cantidadVotos=o.qty_vote)}),void 0!==e.blanco&&this.resultadoMesa&&(this.resultadoMesa.votosBlancos=e.blanco),void 0!==e.nulos&&this.resultadoMesa&&(this.resultadoMesa.votosNulos=e.nulos),void 0!==e.recurridos&&this.resultadoMesa&&(this.resultadoMesa.votosRecurridos=e.recurridos),void 0!==e.impugnados&&this.resultadoMesa&&(this.resultadoMesa.votosImpuganados=e.impugnados),this.actualizarValores()}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(v),t.Y36(d.gz),t.Y36(t.R0b),t.Y36(L.I),t.Y36(c.qu),t.Y36(R.V))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-carga-datos"]],decls:2,vars:2,consts:[["class","header form-grid",4,"ngIf"],[4,"ngIf"],[1,"header","form-grid"],[3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"form-grid"],[1,"form-field"],[1,"label-text"],["matInput","","type","number",3,"ngModel","ngModelChange"],["matInput","","type","number",3,"ngModel","change","ngModelChange"],["class","form-field",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",3,"click"]],template:function(e,o){1&e&&(t.YNc(0,Y,8,3,"div",0),t.YNc(1,$,29,7,"div",1)),2&e&&(t.Q6J("ngIf",o.mesa),t.xp6(1),t.Q6J("ngIf",o.resultadoMesa))},dependencies:[p.sg,p.O5,C.lW,x.KE,x.hX,V.Nt,P.gD,M.ey,c.Fj,c.wV,c.JJ,c.On],styles:[".header[_ngcontent-%COMP%]{background-color:#4379dd;padding:10px}.header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#fff;margin:0}.form-container[_ngcontent-%COMP%]{max-width:600px;margin:0 auto}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:max-content 1fr;grid-gap:16px}.form-field[_ngcontent-%COMP%]{align-self:center;width:100%}.label-text[_ngcontent-%COMP%]{font-size:16px}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));grid-gap:10px}\n\n/*# sourceMappingURL=carga-datos.component.css.map*/"]}),s})()}]}];let w=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[d.Bz.forChild(z),d.Bz]}),s})();var G=i(8521);let K=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[p.ez,w,G.q,c.u5,c.UX]}),s})()}}]);
//# sourceMappingURL=343.5ed7ab8945d246ff.js.map